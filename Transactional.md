 - Spring создает прокси для классов @Transactional. Когда методы вызываются, что вызовы перехватываются (AOP) и подставляется Proxy
 - TransactionManager создает EntityManager и осуществляет старт новой транзакции
 - EntityManager - управляет операциями с бд
 ----- метод flush() - обновляет всю инфу в бд
 ----- метод detach() - "открепляет" сущность от EntityManager
 -------------------------------------------------------------------------------------------------
 Алгоритм создания транзакции:
 - создается новый EntityManager
 - EntityManager привязывается к текущему потоку
 - берется соединение из пула соединений БД
 - соединение привязывается к текущему потоку (ThreadLocal)
 -------------------------------------------------------------------------------------------------
 - Propagation
1. MANDATORY — использует существующую транзакцию. Если ее нет — бросает exception. Если используется для класса, то действует на все public методы.
2. NESTED — вложенная транзакция (подтранзакция). Подтвержается вместе с внешней транзакцией. Если нет существующей транзакции — работает как REQUIRED.
Можно применять в таких случаях, когда: Сработает — норм, не сработает — тоже норм. Самое главное чтобы внешняя транзакция не пострадала.
3. NEVER — означает, что данный метод не должен выполняться в транзакции. Если транзакция запущена — бросает exception.
4. NOT_SUPPORTED — означает не выполнять в текущей транзакции. Если транзакция запущена — она останавливается на время выполнения метода. Метод выполняется вне транзакции. Когда метод выполнился — транзакция запускается.
5. REQUIRED — (по умолчанию) означает, что если запущена транзакция — выполнять внутри нее, иначе создает новую транзакцию. Если ошибка в запросе, то в базу ничего на запишется.
6. REQUIRES_NEW — создает в любом случае новую транзакцию. Если запущена существующая транзакция — она останавливается на время выполнения метода, новый метод выполняется в новой транзакции, и дальше выполняется внешняя транзакция, если она есть.
7. SUPPORTS — может выполняться внутри транзакции, если она запущена, иначе выполнять без транзакции (новую транзакцию не создает), т.е. методу не важно, будет транзакция или нет, он в любом случае выполнится, но если будет транзакция, то он выполнится внутри нее.
